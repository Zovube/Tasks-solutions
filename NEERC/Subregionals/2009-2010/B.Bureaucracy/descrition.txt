ѕроста€ задача, сначала перемудрил с графовым представлением и получил бревно. 
¬ывод: нудно подумать, а потом бросатьс€ писать.